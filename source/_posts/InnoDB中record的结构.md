---
title: InnoDB中record的结构
abbrlink: 4a17b157
---

# InnoDB 中 record 的结构

## 前言

我们都知道，`MySQL`的服务端是通过操作`存储引擎`来读取和写入表中的数据。`MySQL`支持很多种不同的存储引擎，例如`InnoDB`、`MyISAM`、`Memory`之类的。不同的存储引擎是为了不同的目的实现的，**实际的数据在不同的引擎中存放的格式以及方式一般是不一样的**。而我们的`MySQL`中默认的存储引擎是 InnoDB，所以主要了解一下 InnoDB 中一条记录（record）究竟是如何存储的。

### InnoDB 中页的简介

我们要了解`record`在`InnoDB`中究竟是如何被组织的，那么不可避免要接触到的一个概念就是页。**页是`InnoDB`将数据在磁盘与内存中进行交换的基本单位**；同时，**我们的`record`也都是存储在页中**。一般来说页的大小是 16KB。

## 正文

我们使用数据库的时候，数据库中数据的层次结构可以大致理解成：数据库—表—记录。我们平时实际是以记录为单位来对表进行增删改查，记录在磁盘上存储的格式就叫做`行格式`或者`记录格式`。InnoDB 目前有四种不同的`行格式`：`Compact`、`Redundant`、`Dynamic`和`Compressed`。

### Compact 行格式

![COMPACT行格式](/assets/04-01.png)

上图就是 Compact 行格式的示意图，一个 record 可以简单分为`真实数据`与`额外信息`两个部分。

**额外信息**

额外信息也就是 MySQL 为了描述这个记录而加上去的一些信息。信息主要有三类：`变长字段长度列表`、`NULL值列表`与`记录头信息`。

**变长字段长度列表**

众所周知，`MySQL`支持很多变长的数据类型，比如我们很常用的`VARCHAR(M)`、`TEXT`等等。这种字段的长度是不固定的，所以我们在记录他们的真实数据的同时也**需要记录他们所占用的字节数**。

在 Compact 行格式中，InnoDB 会把所有变长字段的真实数据占用的字节长度都存放在记录的开头，并且**变长字段字节长度列表中的的顺序与实际列的顺序是相反的**，也就是以列顺序的逆序存放的。
